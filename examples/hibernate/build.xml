<?xml version="1.0"?>

<project name="Hibernate3" default="deploy" basedir=".">

    <!-- Naming -->
    <property name="Name"                   value="Seam on JBoss Hibernate3 Example"/>
    <property name="example.name"           value="jboss-seam-hibernate"/>

    <!-- Overrides -->
	<property name="example.webinf.lib.dir"  value="."/>
	<property name="example.seam.lib"        value="yes"/>
	<property name="example.facelets.lib"    value="yes"/>
	<property name="example.ds"              value="hibernate-ds.xml"/>
    <property name="src.java.dir"            value="src"/>
    <property name="src.test.dir"            value="src"/>
    <property name="test.classpath"          value="test.mc.classpath"/>
    <property name="tomcat.conf"             value="mc.conf"/>

    <import file="../../build.xml"/>

    <!-- Redefine targets -->
    <target name="war" depends="compile">

    	<jar jarfile="${build.dir}/${example.name}.jar">
          <fileset refid="example.classes"/>
          <fileset dir="resources">
            <include name="seam.properties"/>
            <include name="import.sql"/>
            <include name="hibernate.cfg.xml"/>
          </fileset>
        </jar>
    	
        <copy todir="${build.dir}/resources/WEB-INF">
            <fileset refid="example.war.webinf"/>
            <filterset>
    	        <filter token="jndiPattern" value="${example.name}/#{ejbName}/local"/>
                <filter token="embeddedEjb" value=""/>
                <filter token="microcontainer" value=""/>
            	<filter token="myFacesLifecycleBug" value="false"/>
    	    </filterset>
        </copy>
    	
        <jar destfile="${build.dir}/${example.name}.war">
            <zipfileset refid="example.tomcat.seam.jar"/>
            <zipfileset refid="example.war.docroot"/>
            <zipfileset refid="example.war.webinf.lib"/>
	        <zipfileset refid="facelets.jar"/>
            <zipfileset refid="seam.extra.jar"/>
            <zipfileset dir="${lib.dir}" prefix="WEB-INF/lib">
                <include name="el-*.jar"/>
            </zipfileset>
            <zipfileset dir="${build.dir}/resources">
            	<include name="WEB-INF/**/*.*"/>
            </zipfileset>
            <zipfileset dir="${build.dir}" prefix="WEB-INF/lib">
                <include name="${example.name}.jar"/>
            </zipfileset>
        </jar>
    	
    </target>
    
    <target name="deploy" depends="war"
            description="Deploy the example war to JBoss">
        <fail unless="jboss.home">jboss.home MUST be set. Update build.properties to point to a valid JBoss installation.</fail>
        <copy todir="${deploy.dir}">
            <fileset refid="example.deploy"/>
        </copy>
        <copy file="${build.dir}/${example.name}.war" todir="${deploy.dir}"/>
    </target>

    <target name="undeploy"
    	    description="Undeploy the example war from JBoss">
        <antcall target="Seam.undeploy"><param name="unit.ext" value="war"/></antcall>
    </target>

</project>
