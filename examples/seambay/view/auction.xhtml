<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html">

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>seamBay - Search Results</title>
    <link href="#{facesContext.externalContext.requestContextPath}/style/common.css" rel="stylesheet" type="text/css"/>
    <link href="#{facesContext.externalContext.requestContextPath}/style/auction.css" rel="stylesheet" type="text/css"/>
  </head>

  <body>
    <div class="container">
      <ui:include src="header.xhtml"/>  
      
      <div class="banner"></div>
      
      <h:messages globalOnly="true"/>
      
      <br class="clear"/>
      
      <div class="headerNav">
        <div class="navHome">
          <s:link view="/home.xhtml"><img src="#{facesContext.externalContext.requestContextPath}/img/arrow_left.png" border="0"/></s:link>
        </div>
        <div class="navHome">
          <s:link view="/home.xhtml" value="Back to home page"/>        
        </div>
        
        <div class="navCategory">
          Listed in category: 
          <s:link value="#{auction.category.name}" view="/search.xhtml" propagation="none">
            <f:param name="categoryId" value="#{auction.category.categoryId}"/>
          </s:link>
        </div>
        
        <br class="clear"/>        
      </div>
      
      <div id="itemHeader">
        <div class="headerTitle">
          #{auction.title}
        </div>
                
        <div class="headerStatus">
        
        </div>
      </div>
      
      <div id="itemSummary">
        <div class="itemImage">
          <s:graphicImage rendered="#{auction.image ne null}" value="#{auction.image.data}">
            <s:transformImageSize width="200" maintainRatio="true"/>
          </s:graphicImage>        

          <div>
            <a href="#pictures">View larger picture</a>
          </div>          
          
        </div>
      
        <div class="itemDetails">
          <div class="itemDetailRow">
            <label>
              <s:fragment rendered="#{auction.highBidder ne null}">
                Current bid:
              </s:fragment>
              <s:fragment rendered="#{auction.highBidder eq null}">
                Starting price:
              </s:fragment>            
            </label>
            <div>
              $<b><h:outputText value="#{auction.price}">
                <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
              </h:outputText></b>
            </div>
          </div>
          
          <hr class="itemDetailSeparator" />
          
          <div class="itemDetailRow">
            <label>End time:</label>
            <div>
              <b>
                <h:outputText value="#{auction.endDate}">
                  <f:convertDateTime pattern="dd-MMM-yyyy H:mm:ss"/>
                </h:outputText>
              </b>
              <span> (#{auction.daysHoursLeft})</span>
            </div>
          </div>
          
          <div class="itemDetailRow">
            <label>Item location:</label>
            <div>
              #{auction.account.location}
            </div>
          </div>
          
          <div class="itemDetailRow">
            <label>History:</label>
            <div>
              <s:link view="/bidhistory.seam" propagation="none">
                #{auction.bids} bids
                
                <f:param name="auctionId" value="#{auction.auctionId}"/>
              </s:link>
            </div>
          </div>

          <div class="itemDetailRow">
            <label>High bidder:</label>
            <div>
              <span>#{auction.highBidder.name}</span>
              <h:outputText value="No bids" rendered="#{auction.highBidder eq null}"/>
            </div>
          </div>

          <hr class="itemDetailSeparator" />

        </div>
        
      </div>
      
      <div id="sellerDetail">
        <div class="sellerHeader">Meet the seller</div>
        
        <div class="sellerDetailRow">
          <label>Seller:</label>
          <div>#{auction.account.name}</div>
        </div>
        
        <div class="sellerDetailRow">
          <label>Feedback:</label>
          <div>
            <b>
              <h:outputText value="#{auction.account.feedbackPercent}">
                <f:convertNumber maxFractionDigits="0"/>
              </h:outputText>% Positive
            </b>
          </div>
        </div>
        
        <div class="sellerDetailRow">
          <label>Member:</label>
          <div>
            <span>since </span>
            <h:outputText value="#{auction.account.memberSince}">
              <f:convertDateTime pattern="dd-MMM-yyyy"/>
            </h:outputText>
          </div>
        </div>
        
        <div class="sellerHeader">Buy safely</div>        
      
        <div><b>1. Check the seller's reputation</b></div>
        <div style="margin-left:16px">
          Score: <span>#{auction.account.feedbackScore} | </span>
          <h:outputText value="#{auction.account.feedbackPercent}">
            <f:convertNumber maxFractionDigits="0"/>
          </h:outputText>% Positive<br/>
          <h:outputLink value="#{facesContext.externalContext.requestContextPath}/feedback/#{auction.account.name}">Read the feedback comments</h:outputLink>
        </div>
      </div>
      
      <div class="descriptionHeader">
        Description
      </div>

      <div class="descriptionContent">
        <s:formattedText value="#{auction.description}" />
  
        <hr/>      
        
        <a name="pictures">
          <div class="images">
            <s:graphicImage rendered="#{auction.image ne null}" value="#{auction.image.data}"/>
            
          </div>
        </a>
      </div>
        
    </div>
  </body>
</html>
