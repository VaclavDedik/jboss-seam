<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="includeHeaders">
    <link href="#{themePath}/css/userControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/searchControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/mainMenu.css" rel="stylesheet" type="text/css"/>
</ui:define>

<ui:define name="screenname">Registration</ui:define>

<ui:define name="headerTopRight">
    <ui:include src="includes/userControl.xhtml"/>

</ui:define>
<ui:define name="headerBottomLeft">&#160;</ui:define>

<ui:define name="sidebar">
    <ui:include src="includes/searchControl.xhtml"/>
    <ui:include src="includes/mainMenu.xhtml"/>
</ui:define>

<ui:define name="controlLeft">&#160;</ui:define>

<ui:define name="controlRight">
    <s:link id="exit" styleClass="linkNavigation"
            action="#{browser.exitConversation(true)}"
            accesskey="E"><u>E</u>xit</s:link>
</ui:define>

<ui:define name="content">

<h:form>
    <div class="form">
        <div class="formHead">
            <h:outputText rendered="#{not s:hasPermission('User', 'isAdmin', currentUser)}" value="Register new account"/>
            <h:outputText rendered="#{s:hasPermission('User', 'isAdmin', currentUser)}" value="Create new account"/>
        </div>

        <div class="formFields formBorder wideLabels">

            <s:decorate id="firstnameDecorate" template="includes/formFieldDecorate.xhtml">
                <ui:define name="label">First name</ui:define>
                <h:inputText tabindex="1" size="40" maxlength="63" required="true" value="#{userHome.instance.firstname}">
                    <a:support event="onblur" reRender="firstnameDecorate"/>
                </h:inputText>
            </s:decorate>

            <s:decorate id="lastnameDecorate" template="includes/formFieldDecorate.xhtml">
                <ui:define name="label">Last name</ui:define>
                <h:inputText tabindex="1" size="40" maxlength="63" required="true" value="#{userHome.instance.lastname}">
                    <a:support event="onblur" reRender="lastnameDecorate"/>
                </h:inputText>
            </s:decorate>

            <s:decorate id="emailDecorate" template="includes/formFieldDecorate.xhtml">
                <ui:define name="label">E-Mail</ui:define>
                <h:inputText tabindex="3" size="40" maxlength="255" required="true" value="#{userHome.instance.email}">
                    <a:support event="onblur" reRender="emailDecorate"/>
                </h:inputText>
            </s:decorate>

            <s:decorate id="usernameDecorate" template="includes/formFieldDecorate.xhtml">
                <ui:define name="label">Username</ui:define>
                <h:inputText tabindex="4" size="16" maxlength="16" required="true" value="#{userHome.instance.username}">
                    <a:support event="onblur" action="#{userHome.validateUsername}" reRender="usernameDecorate"/>
                </h:inputText>
            </s:decorate>

            <s:decorate id="passwordDecorate" template="includes/formFieldDecorate.xhtml">
                <ui:define name="label">Password</ui:define>
                <h:inputSecret tabindex="5" size="15" maxlength="15"
                               redisplay="true" value="#{userHome.password}">
                    <a:support event="onblur" action="#{userHome.validatePassword}" reRender="passwordDecorate"/>
                </h:inputSecret>
            </s:decorate>

            <s:decorate id="passwordControlDecorate" template="includes/formFieldDecorate.xhtml">
                <ui:define name="label">Repeat password</ui:define>
                <h:inputSecret tabindex="6" size="15" maxlength="15"
                               redisplay="true" value="#{userHome.passwordControl}">
                    <a:support event="onblur" action="#{userHome.validatePasswordControl}" reRender="passwordControlDecorate"/>
                </h:inputSecret>
            </s:decorate>

            <s:div rendered="#{not s:hasPermission('User', 'isAdmin', currentUser)}">
                <s:div styleClass="entry">
                    <div class="label">Verification question:</div>
                    <div class="output">
                        What is the result of&#160;<h:outputText value="#{captcha.question}"/>?
                    </div>
                </s:div>

                <s:decorate id="verifyCaptchaDecorate" template="includes/formFieldDecorate.xhtml">
                    <ui:define name="label">Enter repsonse</ui:define>
                    <h:inputSecret tabindex="7" size="5" maxlength="5" required="true"
                                   redisplay="true" id="verifyCaptcha" value="#{captcha.response}">
                    </h:inputSecret>
                </s:decorate>
            </s:div>

        </div>

        <div class="formControls wideLabels">

            <div class="entry">
                <div class="label">&#160;</div>
                <div class="input">

                    <h:commandLink id="register" styleClass="button" rendered="#{not s:hasPermission('User', 'isAdmin', currentUser)}"
                                   action="#{userHome.persist}"
                                   tabindex="8" accesskey="G"><span class="buttonLabel">Re<u>g</u>ister</span></h:commandLink>

                    <h:commandLink id="create" styleClass="button" rendered="#{s:hasPermission('User', 'isAdmin', currentUser)}"
                                   action="#{userHome.persist}"
                                   tabindex="8" accesskey="C"><span class="buttonLabel"><u>C</u>reate Account</span></h:commandLink>
                </div>
            </div>

        </div>

    </div>
</h:form>


</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

